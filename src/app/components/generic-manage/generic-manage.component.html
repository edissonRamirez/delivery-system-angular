<div class="header bg-gradient-primary pb-8 pt-5 pt-md-8"></div>

<div class="container-fluid mt--7">
  <div class="row">
    <div class="col-xl-8 order-xl-1">

      <div class="card bg-secondary shadow">

        <!-- HEADER -->
        <div class="card-header bg-white border-0">
          <div class="d-flex justify-content-between align-items-center">
            <h3 class="mb-0">{{ title }}</h3>

            <button class="btn btn-neutral" type="button" (click)="cancel.emit()">
              Cancelar
            </button>
          </div>
        </div>

        <!-- BODY -->
        <div class="card-body">

          <!-- FORM ONLY IF NOT DELETE -->
          <form *ngIf="mode !== 'delete'" [formGroup]="form" (ngSubmit)="onSubmit()">

            <h6 class="heading-small text-muted mb-4">
              Datos del {{ singular }}
            </h6>

            <div class="pl-lg-4">

              <div class="form-group" *ngFor="let f of fields">

                <label class="form-control-label">{{ f.label }}</label>

                <!-- TEXT / EMAIL / NUMBER -->
                <input 
                  *ngIf="['text','email','number','password','date'].includes(f.type)"
                  class="form-control"
                  [type]="f.type"
                  [formControlName]="f.name"
                  [placeholder]="f.placeholder"
                  [disabled]="f.disabled"
                  [ngClass]="{'is-invalid': submitted && form.get(f.name)?.invalid}"
                />

                <!-- TEXTAREA -->
                <textarea 
                  *ngIf="f.type === 'textarea'"
                  class="form-control"
                  [formControlName]="f.name"
                  rows="3">
                </textarea>

                <!-- CURRENCY -->
                <input *ngIf="f.type === 'currency'" class="form-control" type="text"
                  [value]="form.get(f.name)?.value | currency:'COP':'symbol-narrow':'1.0-0'" (input)="onCurrencyInput($event, f.name)"
                  [ngClass]="{'is-invalid': submitted && form.get(f.name)?.invalid}" />

                <!-- SELECT -->
                <select 
                  *ngIf="f.type === 'select'" 
                  class="form-control"
                  [formControlName]="f.name"
                  [ngClass]="{'is-invalid': submitted && form.get(f.name)?.invalid}"
                >
                  <option value="">Seleccione...</option>

                  <option 
                    *ngFor="let op of f.options"
                    [value]="f.optionValue ? op[f.optionValue] : op"
                  >
                    {{ f.optionLabel ? op[f.optionLabel] : op }}
                  </option>
                </select>

                <!-- FILE INPUT -->
                <input 
                  *ngIf="f.type === 'file'" 
                  type="file" 
                  class="form-control"
                  (change)="onFileSelected($event, f.name)"
                />

                <!-- ERROR -->
                <div class="invalid-feedback" *ngIf="submitted && form.get(f.name)?.invalid">
                  Este campo es obligatorio o inválido.
                </div>

              </div>

            </div>

            <hr class="my-4">

            <!-- SAVE BUTTON -->
            <button type="submit" class="btn btn-primary btn-block">
              {{ mode === 'create' ? 'Guardar' : 'Actualizar' }} {{ singular }}
            </button>

          </form>

          <!-- DELETE MODE -->
          <div *ngIf="mode === 'delete'" class="text-center py-5">

            <h4 class="text-danger mb-4">
              ¿Estás seguro de eliminar este {{ singular }}?
            </h4>

            <div class="d-flex justify-content-center gap-3">

              <button class="btn btn-secondary mx-2 px-4" (click)="cancel.emit()">
                Cancelar
              </button>

              <button class="btn btn-danger mx-2 px-4" (click)="onDelete()">
                Eliminar
              </button>

            </div>

          </div>

        </div>

      </div>

    </div>
  </div>
</div>
